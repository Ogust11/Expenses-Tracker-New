<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker (Node 24)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f4f4f4; }
        h1 { text-align: center; color: #111; }
        form { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 15px; font-weight: 600; font-size: 0.9rem; color: #555; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box;}
        button { background-color: #0070f3; color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; margin-top: 25px; width: 100%; font-weight: 600; font-size: 1rem; transition: background 0.2s;}
        button:hover { background-color: #0051a2; }
        #expenses-list { list-style: none; padding: 0; margin-top: 30px; }
        #expenses-list li { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .expense-info { display: flex; flex-direction: column; }
        .expense-desc { font-weight: bold; font-size: 1.1rem; }
        .expense-meta { font-size: 0.85rem; color: #666; margin-top: 4px; }
        .expense-amount { font-weight: bold; color: #e00; font-size: 1.1rem; }
    </style>
</head>
<body>
    <h1>ðŸ’° Expense Tracker</h1>

    <form id="expense-form">
        <label for="description">Description</label>
        <input type="text" id="description" placeholder="e.g. Lunch, Taxi" required>

        <label for="amount">Amount (â‚¬)</label>
        <input type="number" id="amount" step="0.01" placeholder="0.00" required>

        <label for="category">Category</label>
        <select id="category" required>
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Bills">Bills</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Other">Other</option>
        </select>

        <label for="date">Date</label>
        <input type="date" id="date" required>

        <button type="submit">Add Expense</button>
    </form>

    <ul id="expenses-list">
        </ul>

    <script>
        const API_URL = '/api/expenses';
        const expenseForm = document.getElementById('expense-form');
        const expensesList = document.getElementById('expenses-list');

        document.getElementById('date').valueAsDate = new Date();

        async function fetchExpenses() {
            expensesList.innerHTML = '<p style="text-align:center; color:#666;">Loading...</p>';
            try {
                const response = await fetch(API_URL);
                const result = await response.json();

                expensesList.innerHTML = ''; 

                if (result.success && result.data.length > 0) {
                    result.data.reverse().forEach(expense => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="expense-info">
                                <span class="expense-desc">${expense.description}</span>
                                <span class="expense-meta">${expense.category} â€¢ ${expense.date}</span>
                            </div>
                            <span class="expense-amount">-â‚¬${expense.amount.toFixed(2)}</span>
                        `;
                        expensesList.appendChild(li);
                    });
                } else {
                    expensesList.innerHTML = '<p style="text-align:center; color:#888;">No expenses recorded yet.</p>';
                }
            } catch (error) {
                console.error('Fetch error:', error);
                expensesList.innerHTML = '<p style="text-align:center; color:red;">Failed to load expenses.</p>';
            }
        }

        expenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = expenseForm.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = "Adding...";
            btn.disabled = true;

            const newExpense = {
                description: document.getElementById('description').value,
                amount: document.getElementById('amount').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newExpense),
                });
                const result = await response.json();

                if (response.ok && result.success) {
                    expenseForm.reset();
                    document.getElementById('date').valueAsDate = new Date(); 
                    fetchExpenses();
                } else {
                    alert(`Error: ${result.error}`);
                }
            } catch (error) {
                alert('Connection error');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        fetchExpenses();
    </script>
</body>
</html>
